<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 - DEEP SKY</title>
    <style>
        /* 기존 스타일 유지 */
        * { box-sizing: border-box; }
        body { margin: 0; font-family: "Segoe UI", sans-serif; background: #0b0f2b; color: white; min-height: 100vh; display: flex; flex-direction: column; }
        .top-bar { display: flex; align-items: center; padding: 0 20px; background: #070a1d; border-bottom: 1px solid #1b2f80; height: 60px; }
        .logo-area { display: flex; align-items: center; text-decoration: none; color: white; }
        .logo-area img { width: 35px; height: 35px; margin-right: 10px; border-radius: 50%; }
        .logo-area span { font-size: 18px; font-weight: bold; }

        .login-container { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-box { width: 100%; max-width: 400px; background: #161b4a; padding: 40px 30px; border-radius: 20px; border: 1px solid #2d367a; text-align: center; }
        .login-box h2 { color: #7fc7ff; margin-bottom: 30px; }
        
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; font-size: 13px; color: #aaa; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #1b2f80; background: #0b0f2b; color: white; outline: none; }
        input:focus { border-color: #3a5aff; }

        .btn-group { margin-top: 25px; display: flex; flex-direction: column; gap: 10px; }
        button { width: 100%; padding: 13px; border-radius: 8px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-login { background: #3a5aff; color: white; }
        .btn-signup { background: transparent; color: #7fc7ff; border: 1px solid #3a5aff; }
        
        /* 추가 스타일 */
        .link-group { margin-top: 15px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .sub-link { color: #7fc7ff; font-size: 13px; text-decoration: none; cursor: pointer; }
        .sub-link:hover { text-decoration: underline; }
        .info-text { margin-top: 20px; font-size: 12px; color: #666; }

        footer { background: #070a1d; text-align: center; padding: 20px; font-size: 12px; color: #888; border-top: 1px solid #1b2f80; }
    </style>
</head>
<body>

<div class="top-bar">
    <a href="index.html" class="logo-area">
        <img src="logo.png" onerror="this.src='https://via.placeholder.com/35'">
        <span>DEEP SKY</span>
    </a>
</div>

<div class="login-container">
    <div class="login-box">
        <h2>로그인/회원가입</h2>
        
        <div class="input-group">
            <label>이름 (회원가입시)</label>
            <input type="text" id="name" placeholder="실명을 입력해주세요">
        </div>
        <div class="input-group">
            <label>이메일</label>
            <input type="email" id="email" placeholder="example@email.com">
        </div>
        <div class="input-group">
            <label>비밀번호</label>
            <input type="password" id="password" placeholder="6자리 이상">
        </div>

       <div class="btn-group">
    <button class="btn-login" onclick="login()">로그인</button>
    <button class="btn-signup" onclick="signup()">회원가입</button>
    <button type="button" style="background: white; color: #444; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; gap: 10px;" onclick="googleLogin()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> Google로 시작하기
    </button>
</div>
        
        <div class="link-group">
            <a class="sub-link" onclick="resetPassword()">비밀번호 찾기</a>
            <a class="sub-link" onclick="updateEmail()">이메일 변경</a>
        </div>

        <p class="info-text">
            이메일 인증이 완료되어야 활동이 가능합니다.<br>
            문의: leader.deepsky@gmail.com
        </p>
    </div>
</div>

<footer>© DEEP SKY | Bokseong Astronomy and Aerospace Club</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyArvtIZ3QkwUcvz0SLu-AnLRifhkOtQ9CY",
  authDomain: "bokseong-deep-sky.firebaseapp.com",
  databaseURL: "https://bokseong-deep-sky-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "bokseong-deep-sky",
  storageBucket: "bokseong-deep-sky.firebasestorage.app",
  messagingSenderId: "800777151311",
  appId: "1:800777151311:web:8c901fcf0ded04b1941b3a"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // 1. 회원가입 + 이메일 인증 발송
    function signup() {
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const pw = document.getElementById("password").value.trim();

        if(!name || !email || !pw) return alert("모든 항목을 입력해주세요.");

        auth.createUserWithEmailAndPassword(email, pw)
            .then(result => {
                result.user.updateProfile({ displayName: name });
                // 인증 메일 발송
                return result.user.sendEmailVerification();
            })
            .then(() => {
                alert("가입 성공! 입력하신 이메일로 인증 메일을 보냈습니다.\n인증 후 로그인이 가능합니다.");
                location.href = "index.html";
            })
            .catch(err => alert("가입 실패: " + err.message));
    }

    // 2. 로그인 + 인증 여부 확인
    function login() {
        const email = document.getElementById("email").value.trim();
        const pw = document.getElementById("password").value.trim();

        if(!email || !pw) return alert("이메일과 비밀번호를 입력해주세요.");

        auth.signInWithEmailAndPassword(email, pw)
            .then(result => {
                // 이메일 인증 확인
                if (!result.user.emailVerified) {
                    alert("이메일 인증이 완료되지 않았습니다. 메일함을 확인해주세요!");
                    auth.signOut(); // 인증 안됐으면 다시 로그아웃
                } else {
                    alert("로그인 성공!");
                    location.href = "index.html";
                }
            })
            .catch(err => alert("로그인 실패: " + err.message));
    }

    // 3. 비밀번호 재설정
    function resetPassword() {
        const email = document.getElementById("email").value.trim();
        if (!email) return alert("이메일을 먼저 입력해주세요.");
        
        auth.sendPasswordResetEmail(email)
            .then(() => alert("비밀번호 재설정 메일을 보냈습니다."))
            .catch(err => alert("에러: " + err.message));
    }

    // 4. 이메일 주소 변경 (로그인 상태에서만 가능)
    function updateEmail() {
        const user = auth.currentUser;
        if (!user) return alert("로그인한 상태에서만 변경이 가능합니다.");

        const newEmail = prompt("새로운 이메일 주소를 입력하세요:");
        if (newEmail) {
            user.updateEmail(newEmail)
                .then(() => {
                    user.sendEmailVerification();
                    alert("이메일이 변경되었습니다. 새 메일함에서 인증해주세요.");
                })
                .catch(err => {
                    if (err.code === 'auth/requires-recent-login') {
                        alert("보안을 위해 다시 로그인한 후 변경해주세요.");
                        auth.signOut();
                    } else {
                        alert("에러: " + err.message);
                    }
                });
        }
    }

    // 구글 로그인 Provider 설정
const provider = new firebase.auth.GoogleAuthProvider();

function googleLogin() {
    auth.signInWithPopup(provider)
        .then((result) => {
            // 구글 로그인은 이메일 인증이 이미 완료된 것으로 간주하는 경우가 많지만, 
            // 보안을 위해 체크하거나 바로 메인으로 이동시킵니다.
            alert(result.user.displayName + "님, 환영합니다!");
            location.href = "index.html";
        })
        .catch((error) => {
            console.error("구글 로그인 에러:", error);
            alert("구글 로그인에 실패했습니다: " + error.message);
        });
}
</script>
</body>
</html>
